---
title: "The effects of Water and Sanitation on Tuberculosis Incidence in South East Asian and African countris"
author: ""
format:
  docx:
    toc: false
    number-sections: true
    highlight-style: github
bibliography: ../../assets/dataanalysis-references.bib
csl: ../../assets/american-journal-of-epidemiology.csl
editor: 
  markdown: 
    wrap: 72
---

This uses MS Word as output format. [See
here](https://quarto.org/docs/output-formats/ms-word.html) for more
information. You can switch to other formats, like html or pdf. See [the
Quarto documentation](https://quarto.org/) for other formats.

```{r, echo=FALSE, message=FALSE}
# load a few R packages
library(here)
library(knitr)
```

**Authors**

-   Muhammad Nasir$^{1,2,*}$ (ORCID: 0000-0000-1234-5678)
-   Second Author$^{3, *}$
-   Third Author$^{3, \dagger}$
-   Last Author$^{1, 2, \land}$

**Author affiliations**

1.  College of Public Health, University of Georgia, Athens, GA, USA.
2.  Faculty of Public Health, Universitas Tadulako, Palu, Indonesia.
3.  Yet another Affiliation.

$*$ These authors contributed equally to this work.

$\land$ Corresponding author: some\@email.com

$\dagger$ Disclaimer: The opinions expressed in this article are the
author's own and don't reflect their employer.

{{< pagebreak >}}

# Summary/Abstract

*Write a summary of your project.*

{{< pagebreak >}}

# Introduction

## General Background Information

Tuberculosis is old infectious disease which still exists and become
major public health in the world, particularly in developing countries.
Tuberculosis is linked to environmental factors. This study will analyze
the effects of multi environmental factors, specially water and
sanitation on tuberculosis incidence in Asia and Africa regions, where
the majority of tuberculosis coming from these regions. The water and
sanitation will be the main exposures and Human Development Index as a
control variable.

## Description of data and data source

The study will use multi sources of data including World Bank, World
Health Organization (WHO), United Nation for Children Fund (Unicef).
Different dataset contains different variable, however all dataset have
same year, country name and country codes that can be used to combine
the dataset. The data also contain information of countries globally
from 2000 to 2020. The variables will include percentage of population
using safely managed sanitation services, percentage of population using
at least basic drinking water service, percentage of population using
well-managed water, percentage of population using basic sanitation,
percentage of population using well-managed sanitation, and human
development index.

## Questions/Hypotheses to be addressed

*State the research questions you plan to answer with this analysis.*

The main aim of this study is to look at the effect of Water and
Sanitation on on tuberculosis incidence.

RQ: Does access to water and sanitation effect Tuberculosis incidence in
Asian and African Regions?

Null Hypotheisis

H0: thee is no effect of access to basic sanitation on tuberculosis
incidence

H0: thee is no effect of access to safely managed sanitation and on
tuberculosis incidence

H0: there is no effect of access to access basic drinking water and
tuberculosis incidence

H0: there is no effect of access to safely managed drinking water on
tuberculosis incidence

Alternative Hypothesis Ha: thee is an effect of access to basic
sanitation on tuberculosis incidence

Ha: thee is an effect of access to safely managed sanitation and on
tuberculosis incidence

Ha: there is an effect of access to access basic drinking water and
tuberculosis incidence

Ha: there is an effect of access to safely managed drinking water on
tuberculosis incidence

To cite other work (important everywhere, but likely happens first in
introduction), make sure your references are in the bibtex file
specified in the YAML header above and have the right bibtex key. Then
you can include like this:

Examples of reproducible research projects can for instance be found in
[@mckay2020; @mckay2020a].

{{< pagebreak >}}

# Methods

The datasets were loaded one by one, then drop all unused variable
before combined those datasets using reduce() function. Countries, which
have at least one missing years from 2000 to 2020, were dropped from the
study. To make sure that the data is clean and ready to analyse, all
missing values were dropped. This study focuses on South East Asia and
Africa Regions, where the major proportion of tuberculosis cases came.
Therefore, a newsubset for South East Asia and African countries was
created.

After data cleaning, multiple exploratory data analysis was performed
such us summary and visualizing the data. A bloxplot was created to show
Tuberculosis Incidence in each country during the time frame. Spaghetti
plot was created to visualize the trend of tuberculosis incidence and
other variables over the time. Lastly, line charts showing the trend of
all variables in each country.

The exploratory data analysis showed that the data were not normally
distributed and there was no linear relationship between tuberculosis
incidence and other predictors. Therefore, Spearman's correlation matrix
was performed to see the correlations. To have better understanding, a
heat map matrix plot was created to show the correlation.

The main statistical analysis in the study is longitudinal data analysis
(either fixed effect or mixed effect method). To see which one is
better, Hausman Test was performed to determine which model is better.

NOTE: I still need to discuss and need more advice about the data
analysis from Dr. Handel

## Schematic of workflow

NOTE: I AM STILL WORKING TO FIGUR THIS ONE OUT Sometimes you might want
to show a schematic diagram/figure that was not created with code (if
you can do it with code, do it). @fig-schematic is an example of some -
completely random/unrelated - schematic that was generated with
Biorender. We store those figures in the `assets` folder.

```{r}
#| label: fig-schematic
#| fig-cap: "A figure that is manually generated and shows some overview/schematic. This has nothing to do with the data, it's just a random one from one of our projects I found and placed here."
#| echo: FALSE
knitr::include_graphics(here("assets","antigen-recognition.png"))
```

## Data acquisition

The data was downloaded from Worlbank Dataset. However, those data are
originally from many different courses/ organizations, such as World
Bank, WHA, UNICEF, UN-HABITAT, EDGAR, and IHME.

## Data import and cleaning

Data Import and data cleaning process have been explained in the method
part. To see the code for data import and data cleaning , please visit
working directory ("code", "processing-code", "processingfile.qdm").
Processed and clean data are saved at a folder ("data",
"processed-data"). There are many .rds files in the folder indulging
file for each variables, and file after combined all variables.

Dataset are either in excel or CSV files. Several steps from loading to
data analysis:

-   to load the data set in this part using read_excel or read_csv.

-   to combine them base on country name/ code and years.

-   to drop unwanted variables

-   to select Asian and African Countries only

-   to drop N/A or missing value

-   to conduct data exploration

-   to decide suitable analysis method

-   to perform data analysis

## Statistical analysis

*Explain anything related to your statistical analyses.*

The study applied Generalized Additive Mixed Model (GAMM). The model can
capture mixed effect of countries on Tuberculosis Incidence with non
linear relationship. The data analysis started by looking at the
relationship between Tuberculosis Incidence and Predictors. Non linear
relationship was discovered. Human Development Index
(HDI), Access to basic water and well-managed water show curvature
relationship, while access to basic sanitation and well-managed
sanitation show polynomial. There are several models fitted in the study, we start with linear model with all predictors included, followed by Generalized Addictive Models (GAM), Generalized Mixed Addictive Models (GAMM) without interaction, Generalized Mixed Addictive Models (GAMM) with two factor interaction, and Generalized Mixed Addictive Models (GAMM) with two factor interaction after drop interaction which are not significant. After fitting the models, RMSE and AIC were printed to chose the best models. Based on the RMSEs and AICs, GAMM with interaction after deleting unsigniuficant interactions performed best. The RMSE and AIC were visulized using plot for better understanding. 

To maximize test the performance of the model, machine learning was performed. We created splitted data with 75% train data and 25 % test data and setseed (2345). RMSEs and AICs were printed to see the performance of the models and plotted. The final model was fitted into a machine learning, XGBoost. The method is very plexible and can deal with the data conditions (non-linear relationship, some multicolinearity, and binomial distribution). Finally, the model was tunned. 


{{< pagebreak >}}

# Results

## Exploratory/Descriptive analysis

Firs of all, the pattern of the data was explored. The trend of Tuberculosis Incidence for each country during the period was assesed using spagethi plots. The ( @fig-1 ) shows that most countries shows a dicrease of tuberculosis incidence over the period of time. 

```{r}

#| label: fig-1
#| fig-cap: "Trends of Tuberculosis of each country from 2000 to 2020"
#| echo: FALSE
knitr::include_graphics(here("results", "figures", "eda", "tbi_spageti.png"))
```

Figure ( @fig-2 ) shows the trend of percentage of population using safe water, basic water, safe sanitation, basic sanitation, tuberculosis incidence, and human development index over the prerion for each country. It can be seen that the percentage of population having access to water and sanitation and human development index increase over the time, while the tuberculosis incidence decrease. Figure ( @fig-3 ) show the trends of all variables based on region. 

```{r}
#| label: fig-2
#| fig-cap: "Trends of All Variables over the time 2000 to 2020 by countries"
#| echo: FALSE
knitr::include_graphics(here("results", "figures", "eda", "plot_all_vars.png"))
```


```{r}
#| label: fig-3
#| fig-cap: "Trends of All Variables over the time 2000 to 2020 by countries"
#| echo: FALSE
knitr::include_graphics(here("results", "figures", "eda", "plot_all_vars_region.png"))
```



## Basic statistical analysis



As first step of statistical analysis. linearity test was performed, the result shows that there is non-linear relationship between tuberculosis incidence and other predictors. Loess method is used to show the non-linear relationship betwen tuberculosis incidence and predictors. ( @fig-4 ) shows the relationship between tuberculosis incidence and predictors and ( @fig-5 ) show the relationhsip after data transformation. It can be seen that after data transformed, non-linear relationship stil exists. Therefore, Generalized Addittive Mixed Model is used in this study. 


```{r}

#| label: fig-4
#| fig-cap: "Non-linear relationhsip between Tuberculosis Incidence and Predictors "
#| echo: FALSE
knitr::include_graphics(here("results","figures", "analysis", "plots_tbi_vs_allvars.png"))

```
```{r}
#| label: fig-5
#| fig-cap: "Non-linear relationhsip between Tuberculosis Incidence and Predictors after transfirmation "
#| echo: FALSE
knitr::include_graphics(here("results","figures", "analysis", "plot_transformed.png"))
```



Before going further, we need to look at correlation between
tuberculosis Incidence and all predictors. Since they show non linearity, spearman's correlation performed and showing in the following correlation matrix. See ( @fig-6 ) shows  that some variables have multi collinearity. The matrix shows that water and sanitation have low correlation with tuberculosis incidence. 

```{r}


#| label: fig-6
#| fig-cap: "Spearman Correlation Matrix "
#| echo: FALSE
knitr::include_graphics(here("results","figures", "eda", "correlation_matrix.png"))

```


## Full analysis

We start with linear model with all predictors included, followed by Generalized Addictive Models (GAM), Generalized Mixed Addictive Models (GAMM) without interaction, Generalized Mixed Addictive Models (GAMM) with two factor interaction, and Generalized Mixed Addictive Models (GAMM) with two factor interaction after drop interaction which are not significant. AIC and RMSE are used to select the best model. ( @fig-7) show that  and Generalized Mixed Addictive Models (GAMM) with two factor interaction after dropin insignificant interaction performed better. GAMM with full interactions has low AIC and RMSE, but the degree of freedom shows negarive values, indicating inconsistency of the model. 


```{r}

#| label: fig-7
#| fig-cap: "AIC and RMSE "
#| echo: FALSE
knitr::include_graphics(here("results","figures", "analysis", "plot_aic_rmse.png"))
```

***Result of Final Model***

We fitted a generalized additive mixed model (GAMM) using a negative binomial distribution with a log link to model tuberculosis incidence (TBI) across countries in South East Asia and Africa. The model incorporated smooth functions of year, access to basic and safe water and sanitation services, and the Human Development Index (HDI), as well as interaction terms between key environmental and socioeconomic indicators. A random effect was included for country to account for unobserved heterogeneity. (@tbl-1 ) shows the result of the final model. 
```{r}
#| label: tbl-1
#| tbl-cap: "Summary of GAMM Parametric and Smooth Terms"
#| echo: false
#| message: false
#| warning: false

# Load and display the saved gt table
gamm_tbl <- readRDS(here::here("results", "tables", "analysis", "gamm_summary_table.rds"))



gamm_tbl %>%
  gt(groupname_col = "type") %>%
  fmt_number(columns = where(is.numeric), decimals = 3) %>%
  tab_header(
    title = "Summary of GAMM Estimates",
    subtitle = "Parametric and Smooth Terms"
  ) %>%
  cols_label(
    term = "Term", estimate = "Estimate", std.error = "Std. Error",
    edf = "EDF", chi_sq = "Chi-square", p.value = "p-value"
  ) %>%
  fmt_missing(everything(), missing_text = "-")

```


The model demonstrated excellent fit, explaining 99.7% of the deviance (adjusted R² = 0.997). Among the smooth terms, year (edf = 3.38, p < 0.001), access to basic water (edf = 6.52, p = 0.013), access to safe water (edf = 1.00, p < 0.001), and HDI (edf = 1.00, p < 0.001) showed significant non-linear associations with TBI. In contrast, basic and safe sanitation services were not significantly associated with TBI after accounting for other variables.

Notably, several two-dimensional interaction smooths were also statistically significant, including between basic water and HDI (p < 0.001), safe water and HDI (p < 0.001), safe sanitation and basic water (p < 0.001), and safe water and basic water (p < 0.001), suggesting complex joint effects of environmental infrastructure and development on TBI patterns. The random effect for country was highly significant, capturing substantial variation across national contexts.

These findings underscore the importance of improving access to clean water and addressing socioeconomic disparities to reduce tuberculosis burden, while also highlighting the complex interplay between infrastructure and development indicators.



### Machine Learning

To test the consistency of the model, machine learning was used. 

Using Splitted / generated data shows that the model has a consistent result. (@fig-8 ) shows the observed and predicted values both original and generated data. It can be seen that both original data and generated data (both test and training data) have similiar pattern and the plots lay very closed or around the line. 

```{r}
#| label: fig-8
#| fig-cap: "Predicted vs Observed TBI originalvs generated data "
#| echo: FALSE
knitr::include_graphics(here("results","figures", "analysis", "plot_ob_pre_ml_vs_ori.png"))
```



Figure (@fig-9) shows the performance of machine learning (XGboost). The figure shows how well the model predicted tuberculosis incidence (TBI) by comparing the predicted values with the actual reported values for both the training and test data. The dotted line represents perfect prediction—where predicted and actual values would match exactly.

For the training data (right side), the dots are closely lined up along the diagonal line, which means the model predicted the TBI values very accurately for the data it was trained on.

For the test data (left side), most of the points are still close to the line, but some are spread out more, especially at higher TBI values. This means that while the model still performs well on new data, it slightly underestimates TBI in some cases when the actual rates are very high.

Overall, the plot shows that the model is reliable and provides accurate predictions for TBI, even on data it hasn’t seen before. This suggests the model can be useful for forecasting TB burden in similar settings.

```{r}
#| label: fig-9
#| fig-cap: "Predicted and observed value for Xgboost using train and test data"
#| echo: FALSE
knitr::include_graphics(here("results","figures", "analysis", "plot_obs_pred_ml.png"))
```


***Tunning for XGBoost***

```{r}
#| label: fig-10
#| fig-cap: "Tunning Result for XGBoost"
#| echo: FALSE
knitr::include_graphics(here("results","figures", "analysis", "autoplot_xgb_tuning.png"))
```

Figure (@fig-10) shows the results of hyperparameter tuning for the XGBoost model, showing how different parameter values affected the model’s performance, measured by root mean square error (RMSE). Each dot represents one combination of hyperparameters tested during cross-validation. These results highlight that careful tuning of parameters, especially learning rate, tree depth, and sampling rate, is essential to significantly improve model accuracy. The tuning process allowed us to identify a combination of settings that minimized prediction error and led to a more reliable model.




{{< pagebreak >}}

# Discussion

## Summary and Interpretation

*Summarize what you did, what you found and what it means.*


I am still working on it and read more paper to use in this discussion part. I will complete this part this week 

## Strengths and Limitations

*Discuss what you perceive as strengths and limitations of your
analysis.*

## Conclusions

*What are the main take-home messages?*

These findings underscore the significant role of socioeconomic
conditions and sanitation infrastructure in tuberculosis control. While
access to basic and safe water was not a significant predictor,
improvements in sanitation and overall socioeconomic development (HDI)
were strongly associated with lower tuberculosis incidence. Given the
significant country-level differences, tuberculosis prevention
strategies should be tailored to national contexts, emphasizing
improvements in living standards and sanitation access. These results
provide valuable insights for policymakers aiming to design targeted
public health interventions in high-burden settings.

*Include citations in your Rmd file using bibtex, the list of references
will automatically be placed at the end*

This paper [@leek2015] discusses types of analyses.

These papers [@mckay2020; @mckay2020a] are good examples of papers
published using a fully reproducible setup similar to the one shown in
this template.

Note that this cited reference will show up at the end of the document,
the reference formatting is determined by the CSL file specified in the
YAML header. Many more style files for almost any journal [are
available](https://www.zotero.org/styles). You also specify the location
of your bibtex reference file in the YAML. You can call your reference
file anything you like.

{{< pagebreak >}}

# References

I will include reference for the sourse of data in the next step.
